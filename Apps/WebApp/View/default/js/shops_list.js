function changePage(){var a=window.location.hash.replace("#","");if(a=="changeCity"){$("#wst-page1").addClass("wst-page1");$("#wst-page2").show();getCitys()}else{$("#wst-page1").show();$("#wst-footer").show();$("body").removeClass("ajaxpage-active");setTimeout(function(){$("#wst-page2").hide();$("#wst-page1").removeClass("wst-page1")},300)}}function orderCondition(c,b){var a=$(c).attr("class");var d=$(c).attr("status");var e=$(c).siblings(".shops-filter");$(c).addClass("active");e.removeClass("active").attr("status","down");if(a.indexOf("active")==-1){$(c).children(".active-icon").show();$(c).children(".noactive-icon").hide();e.children(".active-icon").hide();e.children(".noactive-icon").show();e.children(".arrow-up").hide()}if(d.indexOf("down")>-1){if(a.indexOf("active")==-1){$(c).children(".arrow-down").show();$(c).children(".arrow-up").hide();$("#shopOrder").val("0")}else{$(c).children(".arrow-down").hide();$(c).children(".arrow-up").show();$(c).attr("status","up");$("#shopOrder").val("1")}}else{$(c).children(".arrow-down").show();$(c).children(".arrow-up").hide();$(c).attr("status","down");$("#shopOrder").val("0")}$("#shopOrderby").val(b);$("#currPage").val("0");$("#shops-list").html("");getShopList()}function getShopList(){$("#loading-icon").show();loading=true;var a={};a.pageSize=10;a.currPage=Number($("#currPage").val())+1;a.desc=$("#shopOrderby").val();a.descType=$("#shopOrder").val();a.key=$("#searchKey").val();$.post(WST.U("WebApp/Shops/getShopsList"),a,function(b){var f=WST.toJson(b);var g="";if(f&&f.root&&f.root.length>0){for(var d=0;d<f.root.length;d++){g+='<a class="shops" href="javascript:void(0);" onclick="goToShopHome('+f.root[d].shopId+","+f.root[d].isSelf+');">';g+='<div class="am-g">';g+='<div class="am-u-sm-3 wst-shopsimage-area">';g+='<img src="'+WST.DEFAULT_IMG+'" data-echo="'+WST.ROOT+"/"+f.root[d].shopImg+'" class="wst-shopsimage">';g+="</div>";g+='<div class="am-u-sm-9">';g+='<div class="am-g">';g+='<div class="am-u-sm-7"><h5 class="wst-shopsname">'+f.root[d].shopName+"</h5></div>";g+='<div class="am-u-sm-5 wst-minmoney">￥'+f.root[d].deliveryStartMoney+"元起配送</div>";g+="</div>";g+='<div class="am-g">';g+='<div class="am-u-sm-7">';for(var e=1;e<6;e++){if(e<=f.root[d].score){g+='<img src="'+WST.ROOT+'/Apps/WebApp/View/default/images/1star.png" class="shops-star">'}else{g+='<img src="'+WST.ROOT+'/Apps/WebApp/View/default/images/gray_star.png" class="shops-star">'}}g+="</div>";var c=(f.root[d].userDistance)?f.root[d].userDistance:"";g+='<div class="am-u-sm-5 wst-distance">'+c+"KM</div>";g+="</div>";g+='<span class="wst-trade">主营：'+f.root[d].catName+"</span>";g+='<span class="wst-address">'+f.root[d].shopAddress+"</span>";g+="</div>";g+="</div></a>"}$("#currPage").val(f.currPage);$("#totalPage").val(f.totalPage)}else{g+='<div class="am-g list-empty">';g+='<div class="am-u-sm-12 am-u-sm-centered" style="text-align:center;">';g+='<span class="list-empty-tips">对不起，附近没有商家。</span>';g+="</div>";g+="</div>"}$("#shops-list").append(g);loading=false;$("#loading-icon").hide();echo.init()})}var currPage=totalPage=0;var loading=false;$(document).ready(function(){initFooter("home");getShopList();$(window).scroll(function(){if(loading){return}if((5+$(window).scrollTop())>=($(document).height()-$(window).height())){currPage=Number($("#currPage").val());totalPage=Number($("#totalPage").val());if(totalPage>0&&currPage<totalPage){getShopList()}}})});