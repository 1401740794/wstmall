function calculateTotalMoney(){var a=$(".check-icon").length;var e=0;var f=false;for(var c=0;c<a;c++){if($(".check-icon").eq(c).attr("class").indexOf("active")!=-1){var b=Number($(".check-icon").eq(c).attr("goodsNum"));var d=Number($(".check-icon").eq(c).attr("shopPrice"));f=true;e+=b*d}}if(f){changeIconStatus($(".total-icon"),2,"active")}else{changeIconStatus($(".total-icon"),2)}$("#total-money").html(e.toFixed(2));calculateDeliveryMoney()}function calculateDeliveryMoney(){var b=$(".check-icon").length;var h=$(".shop-check-icon").length;for(var d=0;d<h;d++){var g=$(".shop-check-icon").eq(d).attr("shop");var k=0;for(var e=0;e<b;e++){if($(".check-icon").eq(e).attr("shop")==g&&$(".check-icon").eq(e).attr("class").indexOf("active")!=-1){var c=Number($(".check-icon").eq(e).attr("goodsNum"));var m=Number($(".check-icon").eq(e).attr("shopPrice"));k+=c*m}}var a=Number($(".shop-check-icon").eq(d).attr("deliveryFreeMoney"));var f="";if(a==0){f+="店铺免运费"}else{if(a>k){f+="满"+a.toFixed(2)+"元免运费，差"+(a-k).toFixed(2)+"元"}else{f+="购买商品已达到"+a.toFixed(2)+"元，店铺免运费"}}var l=$(".shop-check-icon").eq(d).attr("childrenId");$("#"+l).html(f)}}function wstAlert(a){$("#alertMsg").html(a);var b={closeViaDimmer:false};$("#wst-alert").modal(b)}function delGoodsFromCart(){var b=$(".check-icon").length;var a="";for(var c=0;c<b;c++){if($(".check-icon").eq(c).attr("class").indexOf("active")!=-1){a+=Number($(".check-icon").eq(c).attr("cartId"))+"#"}}$.post(WST.U("WebApp/Cart/delCartGoods"),{cartIds:a},function(d){var e=WST.toJson(d);if(e.status==1){wstMsg("删除成功");setTimeout(function(){location.href=WST.U("WebApp/Cart/index")},2000)}})}function changeNum(c,b,e,a){var d=parseInt($("#goodsCount_"+c+"_"+b).val(),10);var d=d?d:1;if(a==1){if(d>1){d=d-1}}else{if(a==2){d=d+1}}$("#goods_"+c).attr("goodsNum",d);changeCartGoodsNum(c,b,d,e)}function changeCartGoodsNum(b,a,c,f,d){var d=(d==0||d==1)?d:-1;var e={};e.goodsId=b;e.goodsAttrId=a;e.num=c;e.isCheck=d;$.post(WST.U("WebApp/Cart/changeCartGoodsNum"),e,function(g){var h=WST.toJson(g);if(h.status==-2){wstMsg("库存不足，当前库存："+h.goodsStock)}else{if(h.status==1){$("#goodsCount_"+b+"_"+a).val(c);calculateTotalMoney()}}})}function changeIsCheck(e){var c=Number($(e).attr("goodsNum"));if(c<=0){wstMsg("购买数量不能小于1");return false}var b=Number($(e).attr("goodsId"));var a=Number($(e).attr("goodsAttrId"));var f=Number($(e).attr("shopPrice"));var d=Number($(e).attr("isCheck"));changeCartGoodsNum(b,a,c,f,d)}$(document).ready(function(){initFooter("cart");calculateTotalMoney();$(".shop-check-icon").click(function(){changeIconStatus($(this),1);var a=$(this).attr("childrenId");var d=($(this).attr("class").indexOf("active")==-1)?0:1;if($(this).attr("class").indexOf("active")==-1){changeIconStatus($("."+a),2)}else{changeIconStatus($("."+a),2,"active")}var e=$(this).attr("shop");var b=$(".check-icon").length;for(var c=0;c<b;c++){if($(".check-icon").eq(c).attr("shop")==e){$(".check-icon").eq(c).attr("isCheck",d);changeIsCheck($(".check-icon").eq(c))}}});$(".check-icon").click(function(){changeIconStatus($(this),1);var f=$(this).attr("parentId");var c=Number($(this).attr("goodsId"));if($(this).attr("class").indexOf("active")==-1){changeIconStatus($("."+f),2);$(this).attr("isCheck",0)}else{var a=$("."+f).attr("childrenId");var b=$("."+a).length;var e=0;for(var d=0;d<b;d++){if($("."+a).eq(d).attr("class").indexOf("active")!=-1){e++}}if(e==b){changeIconStatus($("."+f),2,"active")}$(this).attr("isCheck",1)}changeIsCheck($(this))});$(".total-icon").click(function(){changeIconStatus($(this),1);var c=$(".shop-check-icon").length;var a=$(".check-icon").length;if($(this).attr("class").indexOf("active")==-1){for(var b=0;b<c;b++){changeIconStatus($(".shop-check-icon").eq(b),2)}for(var b=0;b<a;b++){$(".check-icon").eq(b).attr("isCheck",0);changeIconStatus($(".check-icon").eq(b),2);changeIsCheck($(".check-icon").eq(b))}}else{for(var b=0;b<c;b++){changeIconStatus($(".shop-check-icon").eq(b),2,"active")}for(var b=0;b<a;b++){$(".check-icon").eq(b).attr("isCheck",1);changeIconStatus($(".check-icon").eq(b),2,"active");changeIsCheck($(".check-icon").eq(b))}}calculateTotalMoney()});$("#editCart").click(function(){$(this).hide();$(".cartinfo-top").hide();$(".goods-spec").hide();$(".oldgoodsnum").hide();$(".cartinfo-editarea").show();$("#buyit-area").hide();$("#editDone").show();$("#delit-area").show();$(".total-money-area").removeClass("tosubmit").addClass("todel")});$("#editDone").click(function(){location.href=WST.U("WebApp/Cart/index")});$("#delit").click(function(){var a=$(".check-icon").length;var b="";for(var c=0;c<a;c++){if($(".check-icon").eq(c).attr("class").indexOf("active")!=-1){b+=$(".check-icon").eq(c).prev("input.goodsid").val()+"#"}}if(b!=""){wstConfirm("确定删除选中的商品吗？",delGoodsFromCart)}else{wstAlert("请选择要删除的商品")}});$("#buyit-area").click(function(){var a=$(".check-icon").length;var c=true;for(var b=0;b<a;b++){if($(".check-icon").eq(b).attr("class").indexOf("active")!=-1){c=false}}if(c){wstMsg("请勾选要结算的商品");return false}location.href=WST.U("WebApp/Cart/settlement","isDefault=1")})});