function changePage(){var a=window.location.hash.replace("#","");a=a.split("&");if(a[0]=="register"){$("#wst-page2").show();getRegister()}else{if(a[0]=="forgetpassword"){$("#wst-page2").show();getForgetPassword()}else{if(a[0]=="byPhone"){$("#wst-page2").show();byPhone()}else{if(a[0]=="byEmail"){$("#wst-page2").show();byEmail()}else{$("body").removeClass("ajaxpage-active");setTimeout(function(){$("#wst-page2").css("display","none");getVerify("login-verifyImg");$("#wst-username").focus()},300)}}}}}function getRegister(){var b=Handlebars.compile($("#register").text());var a=b("");$("#wst-page2").html(a);$("body").addClass("ajaxpage-active");setTimeout(function(){getVerify("register-verifyImg");$("#register-username").focus()},300);b=a=null}function getForgetPassword(){var b=Handlebars.compile($("#forgetPassword").text());var a=b("");$("#wst-page2").html(a);$("body").addClass("ajaxpage-active");setTimeout(function(){getVerify("forgetpwd-verifyImg");$("#fUsername").focus()},300);b=a=null}function byPhone(){var b=Handlebars.compile($("#byPhone").text());var a=b("");$("#wst-page2").html(a);$("#username").html($("#loginName").val());$("#phone").html($("#userPhone").val());$("body").addClass("ajaxpage-active");setTimeout(function(){getVerify("phone-verifyImg")},300);b=a=null}function byEmail(){var b=Handlebars.compile($("#byEmail").text());var a=b("");$("#wst-page2").html(a);$("#username").html($("#loginName").val());$("#email").html($("#userEmail").val());$("body").addClass("ajaxpage-active");setTimeout(function(){getVerify("email-verifyImg")},300);b=a=null}function loginCheck(){var b=$("#wst-username").val();var a=$("#wst-password").val();var c=$("#wst-verifyCode").val();if(b==""){wstMsg("请输入用户名","wst-username");return false}if(b.length<5||b.length>16){wstMsg("用户名长度应为5至16位之间","wst-username");return false}if(a==""){wstMsg("请输入密码","wst-password");return false}if(a.length<5||a.length>20){wstMsg("密码长度应为5至20位之间","wst-password");return false}if(c==""){wstMsg("请输入验证码","wst-verifyCode");return false}$("#wst-login").attr("disabled","disabled");$.post(WST.U("WebApp/Users/checkCodeVerify"),{code:c},function(d){var e=WST.toJson(d);if(e.status=="1"){$.post(WST.U("WebApp/Users/Login"),{username:b,password:a,rememberPwd:$("#rememberPwd").val()},function(f){var g=WST.toJson(f);if(g.status=="1"){wstMsg("登录成功","",1);var h=(g.originalUrl&&g.originalUrl!="")?g.originalUrl:WST.U("WebApp/Users/index");setTimeout(function(){location.href=h},1500)}else{wstMsg("账号或密码不正确","wst-username");$("#wst-login").removeAttr("disabled");return false}})}else{wstMsg("验证码错误","wst-verifyCode");setTimeout(function(){getVerify("login-verifyImg")},2000);$("#wst-login").removeAttr("disabled");return false}})}function registerCheck(){var c=$("#register-username").val();var a=$("#register-password").val();var b=$("#register-password2").val();var d=$("#register-verifyCode").val();if(c==""){wstMsg("请输入用户名","register-username");return false}if(c.length<5||c.length>16){wstMsg("用户名长度应为5至16位之间","register-username");return false}if(a==""){wstMsg("请输入密码","register-password");return false}if(a.length<5||a.length>20){wstMsg("密码长度应为5至20位之间","register-password");return false}if(b==""){wstMsg("请再输入一次密码","register-password2");return false}if(a!=b){wstMsg("请两次输入的密码不一致","register-password");return false}if(d==""){wstMsg("请输入验证码","register-verifyCode");return false}$("#wst-register").attr("disabled","disabled");$.post(WST.U("WebApp/Users/checkCodeVerify"),{code:d},function(e){var f=WST.toJson(e);if(f.status=="1"){$.post(WST.U("WebApp/Users/register"),{username:c,password:a},function(g){var h=WST.toJson(g);if(h.status=="1"){wstMsg("注册成功");setTimeout(function(){location.href=WST.U("WebApp/Users/index")},1500)}else{wstMsg("账号已存在!","register-username");$("#wst-register").removeAttr("disabled");return false}})}else{wstMsg("验证码错误","register-verifyCode");setTimeout(function(){getVerify("register-verifyImg")},2500);$("#wst-register").removeAttr("disabled");return false}})}function checkLoginKey(){var a=$("#fUsername").val();var b=$("#fVerifyCode").val();if(a==""){wstMsg("请输入用户名","fUsername");return false}if(a.length<5||a.length>16){wstMsg("用户名长度应为5至16位之间","fUsername");return false}if(b==""){wstMsg("请输入验证码","fVerifyCode");return false}$.post(WST.U("WebApp/Users/checkLoginKey"),{loginName:a,code:b},function(c){var d=WST.toJson(c);if(d.status==1){location.href=WST.U("WebApp/Users/findPassword")}else{if(d.status==-2){wstMsg("验证码错误","fVerifyCode");setTimeout(function(){getVerify("forgetpwd-verifyImg")},2000)}else{if(d.status==-1){wstMsg("该用户名不存在","fUsername");setTimeout(function(){getVerify("forgetpwd-verifyImg")},2000)}}}})}function sendSmsCode(){var a=$("#pVerifyCode").val();if(a==""){wstMsg("请输入验证码","pVerifyCode");return false}$("#pButton").attr("disabled","disabled").html("正在处理...");$.post(WST.U("WebApp/Users/sendSmsCode"),{smsVerfy:a},function(b){var c=WST.toJson(b);if(c.status==1){wstMsg("短信发送成功");$("#pToNext").show();var d=120;var e=setInterval(function(){if(d>=1){$("#pButton").html("重新发送("+d+")");d--}else{clearInterval(e);$("#pButton").removeAttr("disabled").html("发送验证短信")}},1000)}else{wstMsg(c.msg);getVerify("phone-verifyImg");$("#pButton").removeAttr("disabled").html("发送验证短信");return false}})}function sendEmailCode(){var a=$("#eVerifyCode").val();if(a==""){wstMsg("请输入验证码","eVerifyCode");return false}$("#eButton").attr("disabled","disabled").html("正在处理...");$.post(WST.U("WebApp/Users/sendEmailCode"),{code:a},function(b){var c=WST.toJson(b);if(c.status==-2){wstMsg("验证码不正确","eVerifyCode");getVerify("email-verifyImg");$("#eButton").removeAttr("disabled").html("发送验证邮件");return false}else{if(c.status==1){wstMsg("邮件发送成功");var d=120;var e=setInterval(function(){if(d>=1){$("#eButton").html("重新发送("+d+")");d--}else{clearInterval(e);$("#eButton").removeAttr("disabled").html("发送验证邮件")}},1000)}else{wstMsg("发送失败，请重试");$("#eButton").removeAttr("disabled").html("发送验证邮件");return false}}})}function toNextByPhone(){var a=$("#phoneVerify").val();if(a==""){wstMsg("请输入短信验证码","phoneVerify");return false}$.post(WST.U("WebApp/Users/checkPhoneVerify"),{phoneVerify:a},function(b){var c=WST.toJson(b);if(c.status==1){location.href=c.url}else{wstMsg("短信验证码不正确","phoneVerify");return false}})}function saveNewPassword(){var a=$("#loginPwd").val();var b=$("#loginPwd2").val();if(a==""){wstMsg("请输入密码","password");return false}if(a.length<5||a.length>20){wstMsg("密码长度应为5至20位之间","loginPwd");return false}if(b==""){wstMsg("请再输入一次密码","loginPwd2");return false}if(a!=b){wstMsg("请两次输入的密码不一致","loginPwd");return false}$.post(WST.U("WebApp/Users/resetPass"),{loginPwd:a,loginPwd2:b},function(c){var d=WST.toJson(c);if(d.status==1){wstMsg("密码重置成功");setTimeout(function(){location.href=WST.U("WebApp/Users/index")},1500)}else{wstMsg(d.msg)}})}$(document).ready(function(){initFooter("users");$("#wst-username").focus();getVerify("login-verifyImg")});