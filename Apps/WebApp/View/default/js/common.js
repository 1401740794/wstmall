var wstStorage=window.localStorage;var WST=WST?WST:{};WST.toJson=function(str){var json={};try{if(typeof(str)=="object"){json=str}else{json=eval("("+str+")")}if(json.status&&json.status=="-999"){wstMsg("对不起，您尚未登录系统，请先登录");setTimeout(function(){location.href=WST.U("WebApp/Users/index")},2000)}}catch(e){wstMsg("系统发生错误:"+e.getMessage);json={}}return json};WST.blank=function(b,a){if(!b){b=""}if(b=="0000-00-00"){b=""}if(b=="0000-00-00 00:00:00"){b=""}if(typeof(b)=="null"){b=""}if(typeof(b)=="undefined"){b=""}if(b==""&&a){b=a}return b};WST.isNumberKey=function(b){var a=(b.which)?b.which:event.keyCode;if(a>31&&(a<48||a>57)){return false}else{return true}};WST.isNumberdoteKey=function(c){var b=c||window.event;var f=b.srcElement||b.target;var a=(c.which)?c.which:event.keyCode;if(a>31&&((a<48||a>57)&&a!=46)){return false}else{if(a==46){var d=f.value;if(d.length==0||d.indexOf(".")!=-1){return false}}return true}};WST.isChinese=function(b,a){var c=/[\u4E00-\u9FA5]|[\uFE30-\uFFA0]/i;if(c.test(b.value)){if(a){b.value=b.value.replace(/[\u4E00-\u9FA5]|[\uFE30-\uFFA0]/ig,"")}return true}return false};WST.isEmail=function(b){var a=new RegExp("^\\w+((-\\w+)|(\\.\\w+))*\\@[A-Za-z0-9]+((\\.|-)[A-Za-z0-9]+)*\\.[A-Za-z0-9]+$");return(a.test(b))};WST.isPhone=function(b){var a=new RegExp("^[1][0-9]{10}$");return(a.test(b))};function toGoodsCat(){location.href=WST.U("WebApp/GoodsCat/index")}function initFooter(d){var c=(d=="home")?"home-active":"home";var b=(d=="category")?"category-active":"category";var a=(d=="cart")?"cart-active":"cart";var e=(d=="users")?"users-active":"users";$("#home").append('<img class="wst-footer-img" src="'+WST.ROOT+"/Apps/WebApp/View/default/images/"+c+'.png" style="width:24px;height:40px;">');$("#category").append('<img class="wst-footer-img" src="'+WST.ROOT+"/Apps/WebApp/View/default/images/"+b+'.png" style="width:24px;height:40px;">');$("#cart").prepend('<img class="wst-footer-img cart-img" src="'+WST.ROOT+"/Apps/WebApp/View/default/images/"+a+'.png" style="width:24px;height:40px;">');$("#users").append('<img class="wst-footer-img" src="'+WST.ROOT+"/Apps/WebApp/View/default/images/"+e+'.png" style="width:24px;height:40px;">')}function wstMsg(b,a,d){$("#wst-modal-content").html(b);$("#wst-msg-modal").show();$("#wst-msg-modal").addClass("am-animation-fade");var c=d?d:2;setTimeout(function(){if(a){$("#"+a).focus()}$("#wst-msg-modal").fadeOut(1000)},c*1000)}function wstConfirm(c,a,b){$("#confirmMsg").html(c);var d={closeViaDimmer:false,relatedTarget:this,onConfirm:a};if(b){d.onCancel=b}$("#wst-confirm").modal(d)}function storageGetItem(a){return wstStorage.getItem(a)}function storageSetItem(a,b){wstStorage.setItem(a,b)}function storageRemoveItem(a){wstStorage.removeItem(a)}function changeIconStatus(a,c,b){if(c==1){if(a.attr("class").indexOf("am-icon-circle-thin")>-1){a.removeClass("am-icon-circle-thin").addClass("am-icon-check-circle active")}else{a.removeClass("am-icon-check-circle active").addClass("am-icon-circle-thin")}}else{if(c==2){if(b=="active"){a.removeClass("am-icon-circle-thin").addClass("am-icon-check-circle active")}else{a.removeClass("am-icon-check-circle active").addClass("am-icon-circle-thin")}}}}function addGoodsCart(c,b,a){var d={};d.gcount=a?a:1;d.goodsId=c;d.goodsAttrId=b;d.rnd=Math.random();$.post(WST.U("WebApp/Cart/addToCartAjax"),d,function(e){var f=WST.toJson(e);if(f.status==1){$.post(WST.U("WebApp/Cart/getCartGoodCnt"),{},function(g){var h=WST.toJson(g);wstMsg("恭喜，加入购物车成功！");$("#cartGoodsNum").show();$("#cartGoodsNum").html(h.goodscnt)})}})}function WSTSearch(a){var b=$("#wst-nav-search").val();if(b==""){wstMsg("请输入要搜索的商品名称","wst-nav-search");return false}var c=(a==1)?"WebApp/Shops/goToShops":"WebApp/Goods/index";location.href=WST.U(c,"key="+b)}function changeGoodsNum(a){var c=parseInt($("#goodscount").val(),10);var c=c?c:1;if(a==1){if(c>1){c=c-1}}else{if(a==2){c=c+1}}var b=parseInt($("#goodscount").attr("maxVal"),10);if(b<=c){c=b}$("#goodscount").val(c)}function buyItNow(b){var c={};var a=$("#goodscount").val();c.gcount=a;c.goodsId=b;c.goodsAttrId=$("#goodsAttrId").val();c.rnd=Math.random();$.post(WST.U("WebApp/Cart/addToCartAjax"),c,function(d){var e=WST.toJson(d);if(e.status==1){location.href=WST.U("WebApp/Cart/index")}})}function addToCart(c){var a=$("#goodscount").val();var b=$("#goodsAttrId").val();addGoodsCart(c,b,a)}function goToShopHome(b,a){location.href=WST.U("WebApp/Shops/index","shopId="+b+"&isSelfShop="+a+"&areaId2="+WST.areaId2)}function goToGoodsDetails(a){location.href=WST.U("WebApp/Goods/goodsDetails","goodsId="+a)}function goToComplains(a){location.href=WST.U("WebApp/OrderComplains/toComplains","orderId="+a)}function favorite(b,d,a){var c={};c.targetId=d;c.favoriteType=a;$.post(WST.U("WebApp/Favorites/favorite"),c,function(e){var f=WST.toJson(e);if(f.status==1){wstMsg("已关注");var g="已关注该商品";if(a==1){g="已关注该店铺"}setTimeout(function(){$(b).attr("disabled","disabled").html(g)},2000)}else{wstMsg("关注失败，请重试")}})}function getVerify(a){$("#"+a).attr("src",WST.U("WebApp/Users/getVerify","rnd="+Math.random()))}function mapCallback(){if(WST.locationFrom=="defaultCity"){AMap.service("AMap.Geocoder",function(){geocoder=new AMap.Geocoder({});geocoder.getLocation(WST.defaultAreaName,function(c,b){if(c==="complete"&&b.info==="OK"){var a={};a.areaId2=WST.defaultAreaId;a.areaName2=WST.defaultAreaName;a.wstLatitude=b.geocodes[0].location.lat;a.wstLongitude=b.geocodes[0].location.lng;setLocationSession(a,1)}else{wstMsg(b)}})})}}function wstGetPosition(){var b,a;b=new AMap.Map("container",{resizeEnable:true});b.plugin("AMap.Geolocation",function(){a=new AMap.Geolocation({timeout:5000});a.getCurrentPosition();AMap.event.addListener(a,"complete",wstGetPositionComplete);AMap.event.addListener(a,"error",wstGetPositionError)})}function wstGetPositionComplete(a){var b=a.position.getLat();var c=a.position.getLng();setRealLocationSession(b,c);AMap.service("AMap.Geocoder",function(){geocoder=new AMap.Geocoder({});var d=[c,b];geocoder.getAddress(d,function(h,g){if(h==="complete"&&g.info==="OK"){if(g.regeocode.addressComponent.city!=""){var e=g.regeocode.addressComponent.city}else{var e=g.regeocode.addressComponent.province}if(e!=WST.areaName2){var f={};f.action="location";f.key=e;$.post(WST.U("WebApp/Index/getCitys"),f,function(i){if(i){if(i.areaId!=WST.areaId2){var j={};j.areaId2=i.areaId;j.areaName2=i.areaName;j.wstLatitude=b;j.wstLongitude=c;wstConfirm("检测到您当前在"+e+"，要切换到"+e+"吗？",function(){setLocationSession(j)})}}})}}})})}function wstGetPositionError(a){wstMsg("定位失败")}function setRealLocationSession(b,c){var a={};a.wstRealLatitude=b;a.wstRealLongitude=c;$.post(WST.U("WebApp/Index/setRealLocationSession"),a)}function setLocationSession(a,b){$.post(WST.U("WebApp/Index/setLocationSession"),a,function(c){var d=WST.toJson(c);if(d.status==1){if(b==1){wstGetPosition()}else{location.href=WST.U("WebApp/Index/index")}}})}$(document).ready(function(){FastClick.attach(document.body);echo.init();if(WST.locationFrom=="defaultCity"){$.getScript(WST.gaodeurl)}$(window).scroll(function(){if($(window).scrollTop()>100){$("#toTop").fadeIn()}else{$("#toTop").fadeOut()}});$("#toTop").on("click",function(){$(window).smoothScroll({position:0})})});